'use strict';

var _ = require('lodash');
var program = require('commander');
var {Config} = require('ripple-command/config');
var {Console} = require('ripple-command/console');
var {RippleWrapper} = require('ripple-command/api/ripple-wrapper');

program
    .command('get-trustlines <address>')
    .description('Returns trustlines for a specified account.')
    .option('--counterparty <address>', 'Only return trustlines with this counterparty.')
    .option('--currency <currency>', 'Only return trustlines for this currency.')
    .option('--ledger-version <int>', 'Return trustlines as they were in this historical ledger version.')
    .option('--limit <int>', 'Return at most this many trustlines.')
    .action(function(address, command) {
        let opts = command.opts();
        Config.absorb(program.opts(), opts);

        let options = _.pickBy(opts, (value) => {
            return value !== undefined;
        });

        for (let intOpt of ['limit', 'ledgerVersion']) {
            if (options[intOpt]) {
                options[intOpt] = parseInt(options[intOpt], 10);
            }
        }

        (new RippleWrapper()).invoke('getTrustlines', address, options).then((trustlines) => {
            Console.out('Trustlines:');
            Console.out(trustlines, 1);
        }).catch(_.noop);
    })
    ;
