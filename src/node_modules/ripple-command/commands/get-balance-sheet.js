'use strict';

var _ = require('lodash');
var program = require('commander');
var {Config} = require('ripple-command/config');
var {Console} = require('ripple-command/console');
var {RippleWrapper} = require('ripple-command/api/ripple-wrapper');

program
    .command('get-balance-sheet <address>')
    .description('Returns aggregate balances by currency plus a breakdown of assets and obligations for a specified account.')
    // TODO - implement array args
    // .option('--exclude-addresses', 'Addresses to exclude from the balance totals.')
    .option('--ledger-version <int>', 'Get the balance sheet as of this historical ledger version.')
    .action(function(address, command) {
        let opts = command.opts();
        Config.absorb(program.opts(), opts);

        let options = _.pickBy(opts, (value) => {
            return value !== undefined;
        });

        for (let intOpt of ['ledgerVersion']) {
            if (options[intOpt]) {
                options[intOpt] = parseInt(options[intOpt], 10);
            }
        }

        (new RippleWrapper()).invoke('getBalanceSheet', address, options).then((sheet) => {
            Console.out('Balance Sheet:');
            Console.out(sheet, 1);
        }).catch(_.noop);
    })
    ;
